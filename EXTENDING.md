# The Conjurer-Reborn Extension System

Conjurer Reborn provides a series of interfaces to control certain aspects of the game. Some of these interfaces require only minor modifications to adapt Conjurer's implementation to Conjurer Reborn's implementation.

## Entities

Add a custom tab to the entity panel

grid_size field will no longer take effect:
```lua
-- init.lua
--
if ModIsEnabled("conjurer_reborn") then
  ModLuaFileAppend(
    "mods/conjurer_reborn/files/wandhelper/ent_list_pre.lua",
    "path/to/my_entities.lua"
  )
end


-- my_entities.lua
--
table.insert(ALL_ENTITIES, {
  name="The Category Pane Name",
  desc="Voluntary tooltip description",
  icon="path/to/category_icon.png",
  icon_off="path/to/category_icon_off.png",  -- The greyed-out unselected variant
  entities={
    {
      name="My Entity",
      desc="Voluntary tooltip description",
      image="path/to/my/entity_icon.png",  -- This should be a 16*16px icon
      path="path/to/my/entity.xml",
      spawn_func=function(x, y)
        -- Do any custom entity loading stuff here when just the path is not enough (eg. perks).
        -- Overrides the `path` variable entirely.
        -- MUST return the entity you loaded.
        return EntityLoad("myentity.xml", x, y)
      end,
      post_processor=function(entity, x, y)
        -- Do anything you want with the entity or its location after it's spawned.
      end,
    },
    {
      name="My Second entity",
      path="path/to/my/entity2.xml",
      image="path/to/my/entity_icon2.png",  -- This should be a 16*16px icon
    },
    -- ... and so on
  },
})
```

## Enemy
The enemy's ID is usually the filename.

### Enemies that will not be displayed

If you want to prevent a specific enemy from being displayed in entwand, you can set it through this interface.
```lua
-- init.lua
--
if ModIsEnabled("conjurer_reborn") then
  ModLuaFileAppend(
    "mods/conjurer_reborn/files/unsafe/DataInterface/IgnoreEnemies.lua",
    "path/to/my_ignore_enemies.lua"
  )
end


-- my_ignore_enemies.lua
--
table.insert(IgnoreEnemies, "enemy_id")
```

### Add additional enemy files

If you need to add enemy files that will not be automatically generated, use this interface to add them, and you can set the newly added files to the front.
```lua
-- init.lua
--
if ModIsEnabled("conjurer_reborn") then
  ModLuaFileAppend(
    "mods/conjurer_reborn/files/unsafe/DataInterface/ExtraEnemiesFile.lua",
    "path/to/my_extra_enemies.lua"
  )
end


-- my_extra_enemies.lua
--
ExtraEnemiesFile["enemy_id"] = {
  first = true, -- If set to false, it will be placed after the automatically generated files.
  list = {
    "path/to/enemy.xml"
  }
}
```

### Add additional enemy description

Add some descriptions, and you can set the text color.
```lua
-- init.lua
--
if ModIsEnabled("conjurer_reborn") then
  ModLuaFileAppend(
    "mods/conjurer_reborn/files/unsafe/DataInterface/EnemiesDesc.lua",
    "path/to/my_enemies_desc.lua"
  )
end


-- my_enemies_desc.lua
--
EnemiesDesc["enemy_id"] = {
  text = "enemy_id's desc", -- The displayed text can use a localization key.
  rgba = "ff4500ff" -- #ff4500ff rgba color
}

EnemiesDesc["enemy_id2"] = {
  text = "enemy_id2's desc", -- The displayed text can use a localization key.
  argb = "ffff4500" -- #ff4500ff argb color
}

```

### Specified new enemy

A method to add an enemy that has not been generated by the automatic generator.
```lua
-- init.lua
--
if ModIsEnabled("conjurer_reborn") then
  ModLuaFileAppend(
    "mods/conjurer_reborn/files/unsafe/DataInterface/NewOtherEnemies.lua",
    "path/to/my_new_enemies.lua"
  )
end


-- my_new_enemies.lua
--
table.insert(NewOtherEnemies,{
  id = "enemy_id",
  from_id = "modid",
  tags = nil, -- Currently unused, and may remain unused permanently.
  png = "path/to/enemy_icon.png",
  files = {
    "path/to/enemy.xml"
  }
})
```


## Materials

Currently, an automated generation method is used, and adding new material tabs is not supported.

### Material Icon generation mode

In some special cases, the nearest neighbor interpolation scaling algorithm is more suitable for material icon generation than the tiling algorithm. If you have such a requirement, you can use the interface provided here.
```lua
-- init.lua
--
if ModIsEnabled("conjurer_reborn") then
  ModLuaFileAppend(
    "mods/conjurer_reborn/files/unsafe/DataInterface/NearestMaterials.lua",
    "path/to/my_mats.lua"
  )
end


-- my_mats.lua
--
table.insert(NearestMaterials, "material_id")

```

### Forced setting of the material's from_id field.

If, for some reason, the mod IDs of some materials in your mod are set incorrectly and you want to manually set them, you can use this interface.
```lua
-- init.lua
--
if ModIsEnabled("conjurer_reborn") then
  ModLuaFileAppend(
    "mods/conjurer_reborn/files/unsafe/DataInterface/MatModidSet.lua",
    "path/to/my_mats.lua"
  )
end


-- my_mats.lua
--
MatModidSet["material_id"] = "modid"

```

### Add additional material description

Add some descriptions, and you can set the text color.
```lua
-- init.lua
--
if ModIsEnabled("conjurer_reborn") then
  ModLuaFileAppend(
    "mods/conjurer_reborn/files/unsafe/DataInterface/MaterialsDesc.lua",
    "path/to/my_mat_desc.lua"
  )
end


-- my_mat_desc.lua
--
MaterialsDesc["material_id"] = {
  text = "material_id's desc", -- The displayed text can use a localization key.
  rgba = "ff4500ff" -- #ff4500ff rgba color
}

MaterialsDesc["material_id2"] = {
  text = "material_id's desc", -- The displayed text can use a localization key.
  argb = "ffff4500" -- #ff4500ff argb color
}

```

## Brushes

Add custom brushes to the brush selection. No tabs (yet).
```lua
-- init.lua
--
if ModIsEnabled("conjurer_reborn") then
  ModLuaFileAppend(
    "mods/conjurer_reborn/files/scripts/lists/new_brushes.lua",
    "path/to/my_brushes.lua"
  )
end


-- my_brushes.lua
--
table.insert(BRUSHES, {
  name="My Custom Hexagonal Filler Brush",
  desc="Voluntary extra description",
  offset_x=2,  -- Manual reticle offset, because not all reticles want to be centered.
  offset_y=2,
  reticle_file="path/to/my/reticle2.png",
  brush_file="path/to/my/brush2.png",
  icon_file="path/to/my/icon.png",
  click_to_use=true,  -- Should the brush activate upon holding or clicking. Voluntary, defaults to false.
  action=function(material, brush, x, y)
    -- Voluntary function, if you want to override the basic drawing
    -- mechanism entirely. Works with either setting on click_to_use.

    GamePrint("Active material: " .. active_material)
    GamePrint("Brush name: " .. brush.name)
    GamePrint("Mouse: "..tostring(x)..", "..tostring(y))
  end,
  release_action=function(material, brush, x, y)
    -- Voluntary function, if you want to give drawing function an extra
    -- action upon releasing the hold/click.
    GamePrint("Active material: " .. active_material)
    GamePrint("Brush name: " .. brush.name)
    GamePrint("Mouse: "..tostring(x)..", "..tostring(y))
  end
})

table.insert(BRUSHES, {
  name="My Custom 5px Brush",
  offset_x=4,
  offset_y=4,
  reticle_file="path/to/my/reticle2.png",
  brush_file="path/to/my/brush2.png",
  icon_file="path/to/my/icon.png",
})
```
